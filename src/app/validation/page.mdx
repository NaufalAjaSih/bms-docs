# Validation Standards

## Daftar Isi

-   [Struktur Dasar Validasi](#struktur-dasar-validasi)
-   [Validation Rules](#validation-rules)
-   [Custom Messages](#custom-messages)
-   [Form Request Validation](#form-request-validation)
-   [Custom Validation Rules](#custom-validation-rules)
-   [Validation di Controller](#validation-di-controller)
-   [Best Practices](#best-practices)

## Struktur Dasar Validasi

### Template Dasar

```php
// Validation rules
$rules = [
    'field_name' => 'required|unique:table_name,field_name',
    'file_field' => 'nullable|file|mimes:jpeg,png,jpg|max:2048',
];

// Custom messages
$messages = [
    'field_name.required' => 'Field name wajib diisi.',
    'field_name.unique' => 'Field name sudah digunakan.',
    'file_field.file' => 'File harus berupa file.',
    'file_field.mimes' => 'Format file harus jpeg, png, atau jpg.',
    'file_field.max' => 'Ukuran file maksimal 2MB.',
];

// Validate
$request->validate($rules, $messages);
```

### Contoh Implementasi

```php
public function store(Request $request)
{
    $rules = [
        'nama' => 'required|unique:biodata,nama',
        'jenis_kelamin' => 'required|in:1,2',
        'tgl_lahir' => 'required|date|before:today',
        'foto' => 'nullable|file|mimes:jpeg,png,jpg|max:2048',
    ];

    $messages = [
        'nama.required' => 'Nama wajib diisi.',
        'nama.unique' => 'Nama sudah digunakan.',
        'jenis_kelamin.required' => 'Jenis kelamin wajib diisi.',
        'jenis_kelamin.in' => 'Jenis kelamin tidak valid.',
        'tgl_lahir.required' => 'Tanggal lahir wajib diisi.',
        'tgl_lahir.date' => 'Tanggal lahir harus berupa tanggal yang valid.',
        'tgl_lahir.before' => 'Tanggal lahir harus sebelum hari ini.',
        'foto.file' => 'Foto harus berupa file.',
        'foto.mimes' => 'Format foto harus jpeg, png, atau jpg.',
        'foto.max' => 'Ukuran foto maksimal 2MB.',
    ];

    $request->validate($rules, $messages);

    // Process data after validation
}
```

## Validation Rules

### Basic Rules

```php
// Required fields
'field_name' => 'required'

// String validation
'field_name' => 'required|string|max:255'

// Email validation
'email' => 'required|email|unique:users,email'

// Numeric validation
'age' => 'required|numeric|min:1|max:120'

// Date validation
'birth_date' => 'required|date|before:today'

// Boolean validation
'is_active' => 'boolean'
```

### File Validation

```php
// Basic file validation
'file' => 'nullable|file|max:2048'

// Image validation
'image' => 'nullable|image|mimes:jpeg,png,jpg|max:2048'

// Document validation
'document' => 'nullable|file|mimes:pdf,doc,docx|max:5120'

// Multiple files
'files.*' => 'nullable|file|mimes:jpeg,png,jpg|max:2048'
```

### Unique Validation

```php
// Basic unique
'email' => 'required|unique:users,email'

// Unique with ignore
'email' => 'required|unique:users,email,' . $user->id

// Unique with custom column
'email' => 'required|unique:users,email,' . $user->id . ',id'

// Unique with conditions
'email' => 'required|unique:users,email,NULL,id,deleted_at,NULL'
```

### Array Validation

```php
// Array validation
'tags' => 'nullable|array'

// Array with specific rules
'tags.*' => 'required|string|max:50'

// Array with min/max
'items' => 'required|array|min:1|max:10'
'items.*' => 'required|integer|exists:products,id'
```

### Conditional Validation

```php
// Conditional validation
'password' => 'required_if:change_password,1|min:8'

// Required with other field
'confirm_password' => 'required_with:password|same:password'

// Required unless
'phone' => 'required_unless:contact_method,email'
```

## Custom Messages

### Template Custom Messages

```php
$messages = [
    // Required messages
    'field_name.required' => 'Field name wajib diisi.',

    // String messages
    'field_name.string' => 'Field name harus berupa teks.',
    'field_name.max' => 'Field name maksimal :max karakter.',
    'field_name.min' => 'Field name minimal :min karakter.',

    // Email messages
    'email.required' => 'Email wajib diisi.',
    'email.email' => 'Format email tidak valid.',
    'email.unique' => 'Email sudah digunakan.',

    // Numeric messages
    'age.required' => 'Usia wajib diisi.',
    'age.numeric' => 'Usia harus berupa angka.',
    'age.min' => 'Usia minimal :min tahun.',
    'age.max' => 'Usia maksimal :max tahun.',

    // Date messages
    'birth_date.required' => 'Tanggal lahir wajib diisi.',
    'birth_date.date' => 'Format tanggal lahir tidak valid.',
    'birth_date.before' => 'Tanggal lahir harus sebelum hari ini.',

    // File messages
    'file.required' => 'File wajib diupload.',
    'file.file' => 'File harus berupa file.',
    'file.mimes' => 'Format file harus :values.',
    'file.max' => 'Ukuran file maksimal :max KB.',

    // Array messages
    'tags.required' => 'Tags wajib diisi.',
    'tags.array' => 'Tags harus berupa array.',
    'tags.min' => 'Tags minimal :min item.',
    'tags.max' => 'Tags maksimal :max item.',
    'tags.*.required' => 'Tag wajib diisi.',
    'tags.*.string' => 'Tag harus berupa teks.',
    'tags.*.max' => 'Tag maksimal :max karakter.',
];
```

### Contoh Custom Messages Lengkap

```php
$messages = [
    // Biodata validation messages
    'nama.required' => 'Nama wajib diisi.',
    'nama.string' => 'Nama harus berupa teks.',
    'nama.max' => 'Nama maksimal :max karakter.',
    'nama.unique' => 'Nama sudah digunakan.',

    'jenis_kelamin.required' => 'Jenis kelamin wajib diisi.',
    'jenis_kelamin.in' => 'Jenis kelamin tidak valid.',

    'tgl_lahir.required' => 'Tanggal lahir wajib diisi.',
    'tgl_lahir.date' => 'Format tanggal lahir tidak valid.',
    'tgl_lahir.before' => 'Tanggal lahir harus sebelum hari ini.',

    'tempat_lahir.string' => 'Tempat lahir harus berupa teks.',
    'tempat_lahir.max' => 'Tempat lahir maksimal :max karakter.',

    'alamat.string' => 'Alamat harus berupa teks.',
    'alamat.max' => 'Alamat maksimal :max karakter.',

    'telepon.string' => 'Telepon harus berupa teks.',
    'telepon.max' => 'Telepon maksimal :max karakter.',
    'telepon.regex' => 'Format telepon tidak valid.',

    'email.email' => 'Format email tidak valid.',
    'email.unique' => 'Email sudah digunakan.',

    'foto.file' => 'Foto harus berupa file.',
    'foto.image' => 'Foto harus berupa gambar.',
    'foto.mimes' => 'Format foto harus :values.',
    'foto.max' => 'Ukuran foto maksimal :max KB.',

    'is_active.boolean' => 'Status aktif tidak valid.',
];
```

## Form Request Validation

### Template Form Request

```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class {Entity}Request extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     */
    public function authorize(): bool
    {
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     */
    public function rules(): array
    {
        $rules = [
            'field_name' => 'required|string|max:255',
            'file_field' => 'nullable|file|mimes:jpeg,png,jpg|max:2048',
        ];

        // Conditional rules for update
        if ($this->isMethod('PUT') || $this->isMethod('PATCH')) {
            $rules['field_name'] = 'required|string|max:255|unique:table_name,field_name,' . $this->route('id');
        }

        return $rules;
    }

    /**
     * Get custom messages for validator errors.
     */
    public function messages(): array
    {
        return [
            'field_name.required' => 'Field name wajib diisi.',
            'field_name.string' => 'Field name harus berupa teks.',
            'field_name.max' => 'Field name maksimal :max karakter.',
            'field_name.unique' => 'Field name sudah digunakan.',
            'file_field.file' => 'File harus berupa file.',
            'file_field.mimes' => 'Format file harus :values.',
            'file_field.max' => 'Ukuran file maksimal :max KB.',
        ];
    }

    /**
     * Get custom attributes for validator errors.
     */
    public function attributes(): array
    {
        return [
            'field_name' => 'field name',
            'file_field' => 'file',
        ];
    }
}
```

### Contoh Form Request

```php
<?php

namespace App\Http\Requests;

use Illuminate\Foundation\Http\FormRequest;

class BiodataRequest extends FormRequest
{
    /**
     * Determine if the user is authorized to make this request.
     */
    public function authorize(): bool
    {
        return true;
    }

    /**
     * Get the validation rules that apply to the request.
     */
    public function rules(): array
    {
        $rules = [
            'nama' => 'required|string|max:100',
            'jenis_kelamin' => 'required|in:1,2',
            'tgl_lahir' => 'required|date|before:today',
            'tempat_lahir' => 'nullable|string|max:100',
            'alamat' => 'nullable|string|max:500',
            'telepon' => 'nullable|string|max:20|regex:/^[0-9+\-\s()]+$/',
            'email' => 'nullable|email|max:100',
            'foto' => 'nullable|file|image|mimes:jpeg,png,jpg|max:2048',
            'is_active' => 'boolean',
        ];

        // Conditional rules for update
        if ($this->isMethod('PUT') || $this->isMethod('PATCH')) {
            $rules['nama'] = 'required|string|max:100|unique:biodata,nama,' . $this->route('id');
            $rules['email'] = 'nullable|email|max:100|unique:biodata,email,' . $this->route('id');
        }

        return $rules;
    }

    /**
     * Get custom messages for validator errors.
     */
    public function messages(): array
    {
        return [
            'nama.required' => 'Nama wajib diisi.',
            'nama.string' => 'Nama harus berupa teks.',
            'nama.max' => 'Nama maksimal :max karakter.',
            'nama.unique' => 'Nama sudah digunakan.',

            'jenis_kelamin.required' => 'Jenis kelamin wajib diisi.',
            'jenis_kelamin.in' => 'Jenis kelamin tidak valid.',

            'tgl_lahir.required' => 'Tanggal lahir wajib diisi.',
            'tgl_lahir.date' => 'Format tanggal lahir tidak valid.',
            'tgl_lahir.before' => 'Tanggal lahir harus sebelum hari ini.',

            'tempat_lahir.string' => 'Tempat lahir harus berupa teks.',
            'tempat_lahir.max' => 'Tempat lahir maksimal :max karakter.',

            'alamat.string' => 'Alamat harus berupa teks.',
            'alamat.max' => 'Alamat maksimal :max karakter.',

            'telepon.string' => 'Telepon harus berupa teks.',
            'telepon.max' => 'Telepon maksimal :max karakter.',
            'telepon.regex' => 'Format telepon tidak valid.',

            'email.email' => 'Format email tidak valid.',
            'email.max' => 'Email maksimal :max karakter.',
            'email.unique' => 'Email sudah digunakan.',

            'foto.file' => 'Foto harus berupa file.',
            'foto.image' => 'Foto harus berupa gambar.',
            'foto.mimes' => 'Format foto harus :values.',
            'foto.max' => 'Ukuran foto maksimal :max KB.',

            'is_active.boolean' => 'Status aktif tidak valid.',
        ];
    }

    /**
     * Get custom attributes for validator errors.
     */
    public function attributes(): array
    {
        return [
            'nama' => 'nama',
            'jenis_kelamin' => 'jenis kelamin',
            'tgl_lahir' => 'tanggal lahir',
            'tempat_lahir' => 'tempat lahir',
            'alamat' => 'alamat',
            'telepon' => 'telepon',
            'email' => 'email',
            'foto' => 'foto',
            'is_active' => 'status aktif',
        ];
    }
}
```

### Penggunaan Form Request di Controller

```php
public function store(BiodataRequest $request)
{
    // Validation sudah otomatis dilakukan
    $validated = $request->validated();

    // Process data
    Biodata::create($validated);

    return response()->json(['status' => 'success']);
}

public function update(BiodataRequest $request, $id)
{
    // Validation sudah otomatis dilakukan
    $validated = $request->validated();

    // Process data
    $biodata = Biodata::findOrFail($id);
    $biodata->update($validated);

    return response()->json(['status' => 'success']);
}
```

## Custom Validation Rules

### Template Custom Rule

```php
<?php

namespace App\Rules;

use Closure;
use Illuminate\Contracts\Validation\ValidationRule;

class CustomRule implements ValidationRule
{
    /**
     * Run the validation rule.
     */
    public function validate(string $attribute, mixed $value, Closure $fail): void
    {
        // Custom validation logic
        if (!$this->passes($attribute, $value)) {
            $fail('The :attribute is invalid.');
        }
    }

    /**
     * Check if validation passes.
     */
    private function passes(string $attribute, mixed $value): bool
    {
        // Custom validation logic here
        return true;
    }
}
```

### Contoh Custom Rule

```php
<?php

namespace App\Rules;

use Closure;
use Illuminate\Contracts\Validation\ValidationRule;

class IndonesianPhoneNumber implements ValidationRule
{
    /**
     * Run the validation rule.
     */
    public function validate(string $attribute, mixed $value, Closure $fail): void
    {
        if (!$this->isValidIndonesianPhone($value)) {
            $fail('Format nomor telepon Indonesia tidak valid.');
        }
    }

    /**
     * Check if phone number is valid Indonesian format.
     */
    private function isValidIndonesianPhone(string $phone): bool
    {
        // Remove spaces, dashes, and parentheses
        $phone = preg_replace('/[\s\-\(\)]/', '', $phone);

        // Check if starts with +62 or 62 or 08
        if (preg_match('/^(\+62|62|08)/', $phone)) {
            // Remove +62, 62, or 08 prefix
            $phone = preg_replace('/^(\+62|62|08)/', '', $phone);

            // Check if remaining digits are 8-11 digits
            return preg_match('/^[0-9]{8,11}$/', $phone);
        }

        return false;
    }
}
```

### Penggunaan Custom Rule

```php
use App\Rules\IndonesianPhoneNumber;

$rules = [
    'telepon' => ['nullable', 'string', new IndonesianPhoneNumber],
];
```

## Validation di Controller

### Template Validation di Controller

```php
public function store(Request $request)
{
    // Validation rules
    $rules = [
        'field_name' => 'required|unique:table_name,field_name',
        'file_field' => 'nullable|file|mimes:jpeg,png,jpg|max:2048',
    ];

    // Custom messages
    $messages = [
        'field_name.required' => 'Field name wajib diisi.',
        'field_name.unique' => 'Field name sudah digunakan.',
        'file_field.file' => 'File harus berupa file.',
        'file_field.mimes' => 'Format file harus jpeg, png, atau jpg.',
        'file_field.max' => 'Ukuran file maksimal 2MB.',
    ];

    // Validate
    $request->validate($rules, $messages);

    // Process data after validation
    $validated = $request->only(['field_name', 'file_field']);

    // Create record
    Model::create($validated);

    return response()->json(['status' => 'success']);
}

public function update(Request $request, $id)
{
    $data = Model::findOrFail($id);

    // Validation rules with unique exception
    $rules = [
        'field_name' => 'required|unique:table_name,field_name,' . $data->id . ',id',
        'file_field' => 'nullable|file|mimes:jpeg,png,jpg|max:2048',
    ];

    // Custom messages
    $messages = [
        'field_name.required' => 'Field name wajib diisi.',
        'field_name.unique' => 'Field name sudah digunakan.',
        'file_field.file' => 'File harus berupa file.',
        'file_field.mimes' => 'Format file harus jpeg, png, atau jpg.',
        'file_field.max' => 'Ukuran file maksimal 2MB.',
    ];

    // Validate
    $request->validate($rules, $messages);

    // Process data after validation
    $validated = $request->only(['field_name', 'file_field']);

    // Update record
    $data->update($validated);

    return response()->json(['status' => 'success']);
}
```

## Best Practices

### 1. **Validation Rules**

-   Gunakan rules yang tepat untuk setiap field
-   Validasi di sisi server dan client
-   Gunakan custom rules untuk validasi kompleks

### 2. **Custom Messages**

-   Berikan pesan error yang jelas dan user-friendly
-   Gunakan bahasa yang konsisten
-   Sertakan placeholder untuk nilai dinamis

### 3. **Form Request**

-   Gunakan Form Request untuk validasi kompleks
-   Pisahkan logic validasi dari controller
-   Reuse Form Request untuk multiple actions

### 4. **Security**

-   Validasi semua input user
-   Sanitasi data sebelum disimpan
-   Gunakan prepared statements

### 5. **Performance**

-   Validasi di awal sebelum processing
-   Gunakan validation caching jika perlu
-   Optimasi custom validation rules

### 6. **Maintainability**

-   Dokumentasikan custom rules
-   Gunakan naming convention yang konsisten
-   Test semua validation scenarios

## Checklist Validation

### Structure

-   [ ] Proper validation rules
-   [ ] Custom messages defined
-   [ ] Form Request implementation
-   [ ] Custom rules (if needed)

### Rules

-   [ ] Required fields validation
-   [ ] Data type validation
-   [ ] File validation
-   [ ] Unique validation
-   [ ] Conditional validation

### Messages

-   [ ] Clear error messages
-   [ ] Consistent language
-   [ ] Dynamic placeholders
-   [ ] User-friendly text

### Security

-   [ ] Input sanitization
-   [ ] File type validation
-   [ ] Size limits
-   [ ] SQL injection prevention

### Performance

-   [ ] Early validation
-   [ ] Efficient rules
-   [ ] Caching (if needed)
-   [ ] Minimal overhead

### Testing

-   [ ] Validation scenarios
-   [ ] Error messages
-   [ ] Custom rules
-   [ ] Edge cases

---

**Selanjutnya**: [Error Handling](08-error-handling.md)
