# Controller — Standar Penulisan & Arsitektur

## 1. Pengantar Controller

Controller bertugas menerima request, meneruskannya ke lapisan bisnis (Service), lalu mengembalikan response ke user.
Dalam standar tim ini, Controller **tidak boleh** berisi logika bisnis, query database, atau proses berat lainnya.

Pemindahan logika ke lapisan lain (Service, Trait, Helper) membuat controller tetap rapi, ringkas, dan mudah dipelihara.

#### Tujuan arsitektur Controller yang bersih:

* Memisahkan tanggung jawab (Separation of Concerns)
* Mempermudah debugging dan pengembangan fitur
* Menghindari *Fat Controller*
* Mendukung maintainability dan scalability aplikasi
* Mempermudah testing karena logika ada di Service

## 2. Prinsip Utama Penulisan Controller

1. **Controller hanya memanggil Service**
   Tidak ada logika bisnis di Controller.

2. **Validasi harus memakai FormRequest**
   Tidak diperbolehkan melakukan validasi manual di Controller.

3. **Semua response JSON wajib melalui `ResponseHelper`**
   Untuk menjaga konsistensi format response di seluruh aplikasi.

4. **Tidak melakukan upload file di Controller**
   Upload harus dilakukan di Service melalui Trait khusus.

5. **Tidak ada transaksi database (`DB::transaction`) di Controller**
   Seluruh transaksi ditangani di Service.

## 3. Struktur Dasar Controller

```php
class ProductController extends Controller
{
    protected $productService;

    public function __construct(ProductService $productService)
    {
        $this->productService = $productService;
    }
}
```

**Penjelasan:**

* Dependency Injection digunakan untuk memasukkan Service.
* Controller hanya bertugas memanggil method dari Service.

## 4. Penjelasan Fungsi-Fungsi Controller

Setiap Controller minimal terdiri dari method umum berikut:
`index`, `show`, `store`, `update`, dan `destroy`.

#### 4.1. Index Method — Halaman Utama + DataTable Ajax

```php
public function index(Request $request)
{
    if ($request->ajax()) {
        return $this->productService->dataTable();
    }

    return view('admin.products.index');
}
```

**Penjelasan:**

| Bagian                  | Fungsi                                                         |
| ----------------------- | -------------------------------------------------------------- |
| `if ($request->ajax())` | Melayani permintaan DataTable, mengembalikan JSON dari Service |
| `return view(...)`      | Menampilkan Blade jika bukan Ajax                              |

---

#### 4.2. Show Method — Detail Data

```php
public function show($id)
{
    try {
        $data = $this->productService->getProductById($id);

        return ResponseHelper::jsonSuccess($data, 'Product berhasil ditemukan.');
    } catch (Exception $e) {
        return ResponseHelper::jsonError($e->getMessage(), 404);
    }
}
```

**Penjelasan:**

* Mengambil data dari Service.
* Mengembalikan JSON success/error berdasarkan hasil.

---

#### 4.3. Store Method — Create Data Baru

```php
public function store(StoreProductRequest $request)
{
    try {
        $this->productService->createProduct($request, $request->file('image'));

        return ResponseHelper::jsonSuccess(null, 'Product berhasil ditambahkan.');
    } catch (Exception $e) {
        return ResponseHelper::jsonError($e->getMessage());
    }
}
```

**Penjelasan:**

* Input sudah divalidasi oleh FormRequest.
* Controller hanya meneruskan data ke Service.
* Response dikembalikan menggunakan Helper.

---

#### 4.4. Update Method — Update Data

```php
public function update(UpdateProductRequest $request, $id)
{
    try {
        $this->productService->updateProduct($request, $id, $request->file('image'));

        return ResponseHelper::jsonSuccess(null, 'Product berhasil diupdate.');
    } catch (Exception $e) {
        return ResponseHelper::jsonError($e->getMessage());
    }
}
```

**Penjelasan:**

* Tidak ada logika update di controller.
* Semua dipindahkan ke Service.

---

#### 4.5. Destroy Method — Hapus Data

```php
public function destroy($id)
{
    try {
        $this->productService->deleteProduct($id);

        return ResponseHelper::jsonSuccess(null, 'Product berhasil dihapus.');
    } catch (Exception $e) {
        return ResponseHelper::jsonError($e->getMessage());
    }
}
```

**Penjelasan:**

* Controller hanya memanggil Service.
* Error handling tetap seragam melalui ResponseHelper.

## 5. Aturan Wajib Controller

| Dilarang                       | Alasannya                    |
| ------------------------------ | ---------------------------- |
| ❌ Query database di controller | Harus menggunakan Service    |
| ❌ Upload file                  | Gunakan Trait via Service    |
| ❌ Validasi manual              | Gunakan FormRequest          |
| ❌ Response JSON custom         | Harus memakai ResponseHelper |
| ❌ Menulis logika bisnis        | Controller harus “tipis”     |
| ❌ Menangani transaksi          | Ditangani di Service         |

## 6. Ringkasan

**Controller = perantara**

Controller hanya:

* menerima request
* memanggil service
* mengembalikan response (JSON/Blade)
* menggunakan FormRequest

**Controller tidak boleh berisi logika bisnis dalam bentuk apa pun.**

## 7. Contoh Controller Lengkap

*(Tetap ditampilkan sebagai referensi standar implementasi)*

```php
class ProductController extends Controller
{
    protected $productService;

    public function __construct(ProductService $productService)
    {
        $this->productService = $productService;
    }

    public function index(Request $request)
    {
        if ($request->ajax()) {
            return $this->productService->dataTable();
        }

        return view('admin.products.index');
    }

    public function show($id)
    {
        try {
            $data = $this->productService->getProductById($id);

            return ResponseHelper::jsonSuccess($data, 'Product berhasil ditemukan.');
        } catch (Exception $e) {
            return ResponseHelper::jsonError($e->getMessage(), 404);
        }
    }

    public function store(StoreProductRequest $request)
    {
        try {
            $this->productService->createProduct($request, $request->file('image'));

            return ResponseHelper::jsonSuccess(null, 'Product berhasil ditambahkan.');
        } catch (Exception $e) {
            return ResponseHelper::jsonError($e->getMessage());
        }
    }

    public function update(UpdateProductRequest $request, $id)
    {
        try {
            $this->productService->updateProduct($request, $id, $request->file('image'));

            return ResponseHelper::jsonSuccess(null, 'Product berhasil diupdate.');
        } catch (Exception $e) {
            return ResponseHelper::jsonError($e->getMessage());
        }
    }

    public function destroy($id)
    {
        try {
            $this->productService->deleteProduct($id);

            return ResponseHelper::jsonSuccess(null, 'Product berhasil dihapus.');
        } catch (Exception $e) {
            return ResponseHelper::jsonError($e->getMessage());
        }
    }
}
```